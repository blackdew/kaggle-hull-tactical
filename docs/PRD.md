# Hull Tactical Market Prediction - Product Requirements Document

## 프로젝트 개요

### 목표
**포지션 사이징**: S&P 500에 대한 최적 자금 배분 비율(0~2)을 예측하여 효율적 시장 가설(EMH)에 도전하는 투자 전략 개발

### 컨테스트 정보
- **주최**: Hull Tactical Asset Allocation LLC
- **플랫폼**: Kaggle
- **시작일**: 2025년 9월 17일
- **최종 제출**: 2025년 12월 15일
- **예측 단계**: 2025년 12월 15일 ~ 2026년 6월 16일 (실제 시장 데이터 평가)
- **상금**: 총 $100,000 (1등 $50,000, 2등 $25,000, 3등 $10,000)

## 비즈니스 요구사항

### 핵심 목표
1. **포지션 사이징**: S&P 500에 대한 일별 자금 배분 비율 예측 (0~2 범위)
2. **리스크 관리**: 120% 변동성 제약 조건 하에서 안정적인 성과 달성
3. **EMH 도전**: 실제 투자 전략으로 효율적 시장 가설 반박
4. **라이브 운용**: 실제 시장에서 운용 가능한 전략 개발

### 성공 지표
- **주요 지표**: Modified Sharpe Ratio (공식 코드: [Kaggle 노트북 참조](https://www.kaggle.com/code/metric/hull-competition-sharpe))
- **제약 조건**: 120% 변동성 제약 (전략 변동성 ≤ 1.2 × 시장 변동성)
- **벌점 시스템**:
  - 변동성 초과 시: 지수적 페널티 적용
  - 언더퍼폼 시: 음수 Sharpe Ratio로 처리
- **벤치마크**: S&P 500 지수 대비 초과 성과

## 데이터 명세

### 훈련 데이터
- **크기**: 8,980개 샘플, 98개 피처
- **기간**: 일별 시계열 데이터 (date_id 0~8979)
- **타깃(내부 예측/참고)**:
  - `forward_returns`: 미래 수익률
  - `market_forward_excess_returns`: 시장 초과 수익률 (예측 대상)
  - `risk_free_rate`: 무위험 수익률

### 피처 그룹
- **D (Date)**: 9개 - 날짜/시간 관련 피처
- **E (Event)**: 20개 - 시장 이벤트 관련 피처
- **I (Index)**: 9개 - 지수 관련 피처
- **M (Macro)**: 18개 - 거시경제 지표
- **P (Price)**: 13개 - 가격 관련 피처
- **S (Sentiment)**: 12개 - 시장 감정 지표
- **V (Volatility)**: 13개 - 변동성 지표

### 테스트 데이터
- **크기**: 10개 샘플, 99개 피처 (date_id 8980~8989)
- **추가 피처**: `is_scored`, `lagged_forward_returns`, `lagged_risk_free_rate`, `lagged_market_forward_excess_returns`
- **제출 대상**: `prediction` 칼럼에 S&P 500 자금 배분 비율 (0~2)

## 기술 요구사항

### 모델 제약사항
1. **실시간 배치 처리**: 각 거래일 배치별 포지션 사이징 수행
2. **안정성**: 다양한 시장 상황에서 일관된 성과 (120% 변동성 제약 준수)
3. **해석가능성**: 투자 결정에 활용 가능한 수준의 설명력
4. **실행 제약**: 8시간 이내 노트북 실행 완료 (예측 단계 9시간)
5. **레버리지 관리**: 0~2 범위 내 자금 배분 비율 유지

### 데이터 처리 고려사항
- **결측치**: 다수 피처에서 상당한 결측치 존재 (최대 77%)
- **시계열 특성**: 시간 순서가 중요한 금융 데이터
- **피처 선택**: 높은 차원의 데이터에서 유의미한 신호 추출
- **정규화**: 서로 다른 스케일의 피처들 표준화

## 솔루션 아키텍처

### 단계별 접근법
1. **데이터 전처리**
   - 결측치 처리 전략 수립
   - 피처 엔지니어링
   - 시계열 분할 (time-based split)

2. **모델 개발**
   - 베이스라인 모델 (Linear Regression, Random Forest)
   - 앙상블 모델 (XGBoost, LightGBM)
   - 딥러닝 모델 (LSTM, Transformer)

3. **리스크 관리**
   - 변동성 예측 모델
   - 포지션 사이징 알고리즘
   - 드로우다운 제어

4. **백테스팅**
   - 시간 기반 교차 검증
   - Modified Sharpe Ratio 최적화
   - 실전 성과 시뮬레이션

### 평가 전략
- **Local Validation**: 시계열 분할을 통한 내부 검증
- **Cross Validation**: Time Series Split + Purged Cross-Validation (금융 시계열 특화)
- **Embargo Period**: 정보 누수 방지를 위한 시간 간격 설정
- **메트릭**: Modified Sharpe Ratio, Information Ratio, Maximum Drawdown

## 리스크 및 제약사항

### 데이터 관련 리스크
- 높은 결측치 비율로 인한 정보 손실
- 시장 체제 변화로 인한 모델 성능 저하
- 오버피팅 위험 (높은 차원, 상대적으로 적은 샘플)

### 모델 관련 제약
- 실시간 추론 성능 요구사항
- 변동성 제약 조건 준수 필요
- 금융 규제 및 윤리적 고려사항

### 완화 전략
- 앙상블을 통한 모델 안정성 확보
- 정규화 기법으로 오버피팅 방지
- 로버스트한 피처 선택 방법론 적용
- kaggle_evaluation API 통합으로 제출 안정성 확보

## 납품물

### 최종 산출물
1. **예측 모델**: 일별 초과 수익률 예측 시스템
2. **백테스팅 리포트**: 모델 성능 분석 결과
3. **코드베이스**: 재현 가능한 모델 파이프라인
4. **문서화**: 모델 설명 및 운영 가이드

### 제출 형식
- **API 기반 제출**: kaggle_evaluation.core.templates.InferenceServer 상속
- **배치 처리**: date_id별 순차 배치 처리 (DefaultGateway.generate_data_batches)
- **검증**: competition_specific_validation 통과 필요
- **런타임 제약**: 노트북 8시간 (학습 단계), 9시간 (예측 단계), 인터넷 비활성화

#### 신호-포지션 매핑 정책
- **모델 출력**: 시장 초과 수익률 예측 (`market_forward_excess_returns`)
- **변환 공식**: `position = max(0, min(2, 1 + excess_return_pred × leverage_factor))`
- **변동성 조정(기본값)**: `leverage_factor = min(2.0, target_volatility / predicted_volatility)` (20D 롤링 표준편차 기준)
- **제출 값**: `prediction` 칼럼에 최종 포지션 (0~2 범위, 소수점 허용)
- **예시**: 예측 초과수익률 +0.01 → 포지션 1.5 (150% 익스포저)

#### 평가 및 제약
- **평가 방식**: Modified Sharpe Ratio 기준, 120% 변동성 제약 하에서 평가
- **예측 단계**: 2025년 12월 15일 이후 실제 시장에서 6개월간 라이브 운용 평가
※ 정확한 구현은 공식 평가 코드(링크) 기준을 따른다.

## ✅ 핵심 요구사항 확인 완료

### 경진대회 핵심 특징:
1. **포지션 사이징**: 수익률 예측이 아닌 S&P 500 자금 배분 비율 예측
2. **변동성 제약**: 120% 변동성 상한선 하에서 Modified Sharpe Ratio 최적화
3. **실시간 운용**: 실제 시장 데이터로 6개월간 라이브 평가
4. **EMH 도전**: 효율적 시장 가설에 대한 실증적 반박 목표
5. **레버리지 허용**: 0~2 범위로 레버리지 투자 전략 가능

### 성공을 위한 핵심 전략:
1. **리스크 우선**: 수익률보다 변동성 관리에 집중
2. **견고성**: 다양한 시장 환경에서 안정적 성과 유지
3. **실행 가능성**: 실제 거래에서 구현 가능한 전략 설계
